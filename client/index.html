<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Flightâ€‘IntelÂ Uploader</title>
<style>
  body { font-family: sans-serif; max-width: 900px; margin: auto; padding: 2rem; }
  table { border-collapse: collapse; width: 100%; margin-top: 1rem; }
  th, td { border: 1px solid #ddd; padding: 4px; text-align: left; font-size: .9rem; }
  #summary { margin-top: 1.5rem; background: #f9f9f9; padding: 1rem; border-radius: 4px; }
  select, input[type=file], button { margin-top: .8rem; }
</style>
</head>
<body>
  <h1>Upload roster image</h1>

  <!-- ðŸ”½ Airline selector built from the big dict -->
  <label>
    Airline&nbsp;
    <select id="airline">
      <option value="">â€“â€¯pickâ€¯â€“</option>
    </select>
  </label><br>

<input type="file" id="file" accept="image/*,application/pdf,.pdf" />
  <button id="go">Extract</button>

  <pre id="raw"></pre>
  <div id="summary"></div>
  <div id="tbl"></div>

<script>
/* ---------- 1. The master list (mirrors airlines.py) ---------- */
const AIRLINE_CODES = {
  "AA": {icao:"AAL", name:"AmericanÂ Airlines"},
  "UA": {icao:"UAL", name:"UnitedÂ Airlines"},
  "DL": {icao:"DAL", name:"DeltaÂ AirÂ Lines"},
  "WN": {icao:"SWA", name:"SouthwestÂ Airlines"},
  "B6": {icao:"JBU", name:"JetBlueÂ Airways"},
  "AS": {icao:"ASA", name:"AlaskaÂ Airlines"},
  "NK": {icao:"NKS", name:"SpiritÂ Airlines"},
  "F9": {icao:"FFT", name:"FrontierÂ Airlines"},
  "G4": {icao:"AAY", name:"AllegiantÂ Air"},
  "SY": {icao:"SCX", name:"SunÂ CountryÂ Airlines"},
  "HA": {icao:"HAL", name:"HawaiianÂ Airlines"},
  "MX": {icao:"MXY", name:"BreezeÂ Airways"},
  "5X": {icao:"UPS", name:"UPSÂ Airlines"},
  "FX": {icao:"FDX", name:"FedExÂ Express"},
  "5Y": {icao:"GTI", name:"AtlasÂ Air"},
  "K4": {icao:"CKS", name:"KalittaÂ Air"},
  "NC": {icao:"NAC", name:"NorthernÂ AirÂ Cargo"},
  "GB": {icao:"ABX", name:"ABXÂ Air"},
  "3S": {icao:"PAC", name:"PolarÂ AirÂ Cargo"},
  "M6": {icao:"AJT", name:"AmerijetÂ International"},
  "CV": {icao:"CLX", name:"Cargolux"},
  "KZ": {icao:"NCA", name:"NipponÂ CargoÂ Airlines"},
  "PO": {icao:"PAC", name:"PolarÂ AirÂ Cargo"},
  "OO": {icao:"SKW", name:"SkyWestÂ Airlines"},
  "9E": {icao:"EDV", name:"EndeavorÂ Air"},
  "ZW": {icao:"AWI", name:"AirÂ Wisconsin"},
  "YV": {icao:"ASH", name:"MesaÂ Airlines"},
  "YX": {icao:"RPA", name:"RepublicÂ Airways"},
  "OH": {icao:"JIA", name:"PSAÂ Airlines"},
  "MQ": {icao:"ENY", name:"EnvoyÂ Air"},
  "G7": {icao:"GJS", name:"GoJetÂ Airlines"},
  "CP": {icao:"CPZ", name:"CompassÂ Airlines"},
  "PT": {icao:"PDT", name:"PiedmontÂ Airlines"},
  "9K": {icao:"KAP", name:"CapeÂ Air"},
  "C5": {icao:"UCA", name:"CommutAir"},
  "QX": {icao:"QXE", name:"HorizonÂ Air"},
  "AX": {icao:"LOF", name:"TransÂ StatesÂ Airlines"},
  "EV": {icao:"ASQ", name:"ExpressJetÂ Airlines"},
  "S5": {icao:"TCF", name:"ShuttleÂ America"},
  "N0": {icao:"NBT", name:"NorseÂ AtlanticÂ Airways"},
  "MN": {icao:"CAW", name:"ComairÂ (SA)"},
  "XT": {icao:"CXP", name:"XtraÂ Airways"},
  "SX": {icao:"SKX", name:"SkywaysÂ Express"},
  "EG": {icao:"JAA", name:"JapanÂ AsiaÂ Airways"},
  "VX": {icao:"VRD", name:"VirginÂ America"},
  "FL": {icao:"TRS", name:"AirTranÂ Airways"},
  "TZ": {icao:"AMT", name:"ATAÂ Airlines"},
  "J7": {icao:"VJA", name:"ValuJet"},
  "WP": {icao:"MKU", name:"IslandÂ Air"},
  "XO": {icao:"XOJ", name:"XOJET"},
  "FJ": {icao:"LXJ", name:"Flexjet"},
  "NJ": {icao:"EJA", name:"NetJets"},
  "WU": {icao:"UPJ", name:"WheelsÂ Up"},
  "JJ": {icao:"JIT", name:"JetÂ It"},
  "SJ": {icao:"URF", name:"SurfÂ Air"}
};

/* ---------- 2. Populate the <select> ---------- */
const airlineSel = document.getElementById("airline");
Object.entries(AIRLINE_CODES)
  .sort(([a], [b]) => a.localeCompare(b))
  .forEach(([iata, data]) => {
    const opt = document.createElement("option");
    opt.value = iata;              // weâ€™ll send the IATA
    opt.textContent = `${iata} â€“ ${data.name}`;
    airlineSel.appendChild(opt);
  });

/* ---------- 3. Helper ---------- */
const $ = id => document.getElementById(id);

/* ---------- 4. Upload & call API ---------- */
$("go").onclick = async () => {
  const file = $("file").files[0];
  const iata = airlineSel.value;
  if (!file)  return alert("Choose an image first");
  if (!iata)  return alert("Pick an airline");

  const fd = new FormData();
  fd.append("file", file);

  $("raw").textContent = "Processingâ€¦";
  $("summary").textContent = "";
  $("tbl").innerHTML = "";

  try {
    const u = `http://localhost:8000/extract?airline=${encodeURIComponent(iata)}`;
    const res  = await fetch(u, { method:"POST", body: fd });
    if (!res.ok) throw new Error(`${res.status}Â ${res.statusText}`);

    const data = await res.json();
    $("raw").textContent = JSON.stringify(data, null, 2);

    // Validation summary (if returned)
    const v = data?.schedule_metadata?.validation;
    if (v) {
      $("summary").innerHTML = `
        <strong>Validation</strong><br>
        Valid flights: ${v.valid_flights}/${v.total_flights}<br>
        AvgÂ conf: ${(v.average_confidence*100).toFixed(1)}%<br>
        Sources:Â ${v.sources_used.join(",Â ")}
      `;
    }

    // Flight table
    if (data?.flights?.length) {
      const rows = data.flights.map(f => `
        <tr>
          <td>${f.date}</td>
          <td>${f.flight_no}</td>
          <td>${f.origin||""}</td>
          <td>${f.dest||""}</td>
          <td>${f.sched_out_local||""}</td>
          <td>${f.sched_in_local||""}</td>
          <td>${f.actual_out||""}</td>
          <td>${f.actual_in||""}</td>
        </tr>`).join("");
      $("tbl").innerHTML = `
        <table>
          <thead>
            <tr><th>Date</th><th>Flight</th><th>Origin</th><th>Dest</th>
                <th>SchedÂ Out</th><th>SchedÂ In</th>
                <th>ActÂ Out</th><th>ActÂ In</th></tr>
          </thead><tbody>${rows}</tbody>
        </table>`;
    }
  } catch (err) {
    $("raw").textContent = "Error: " + err.message;
  }
};
</script>
</body>
</html>
